import{P as g,a as c,e as k,D as O,p as C}from"./iframe-P3Y-woc8.js";class B extends g{constructor(t,a={},n={}){const{onBeforeLeave:e,...o}=n;n=Object.assign(y(),o,{onBeforeLeave:s=>{this.dialogOptions?.onClose?.(),e?.(s)}}),super(s=>{const i=this.#t;return c(i,{...s})},n),this.DialogContent=t,this.dialogOptions=a,this.baseOptions=n,this.Content=this.#t}Content=()=>null;asyncCallbackRef=k.createRef();#t=t=>{const a=this.DialogContent;return c(O,{...this.dialogOptions,onClose:this.close,dialogPortalInstance:this,children:c(a,{...t,dialogPortalInstance:this,defineOnOk:this.defineOnOk,defineOnCancel:this.defineOnCancel})})};defineOnOk=t=>{this.asyncCallbackRef.current||(this.asyncCallbackRef.current={}),this.asyncCallbackRef.current.onOk=t};defineOnCancel=t=>{this.asyncCallbackRef.current||(this.asyncCallbackRef.current={}),this.asyncCallbackRef.current.onCancel=t};open=(t,a={},n={})=>new Promise((e,o)=>{let s=0;const{asyncCallback:i,...p}=a,r=i||this.dialogOptions.asyncCallback,d=(u,l)=>{r?r(u,l):(s++,s>1&&console.debug("Dialog Callback 只会触发一次, 如有需要请使用 asyncCallback 来替代")),u==="ok"?e(l):o(l)},h=n.onBackgroundClickClose,f=n.onEscClose;n.onBackgroundClickClose=()=>{h?.(),o()},n.onEscClose=()=>{f?.(),o()},this.updateDialogOptionsStatic({asyncCallback:d,...p}),n&&this.updateBaseOptionsStatic(n),this.baseOpen(t)});dispatchUpdate=(t,a={},n={})=>{const{popupsMap:e,updateCount:o}=C.getState();e.has(this.popupId)&&(a&&this.updateDialogOptionsStatic(a),n&&this.updateBaseOptionsStatic(n),e.set(this.popupId,[this,t]),C.setState({popupsMap:e,updateCount:o+1}))};updateDialogOptionsStatic=t=>{Object.assign(this.dialogOptions,t)};updateBaseOptionsStatic=t=>{Object.assign(this.baseOptions,t)}}function y(){return{positionType:"dialog-center",contentAnimationConfig:"dialogZoomOut",overlay:!0,clickToClose:!1,lockScroll:!0,createContainerId:"taomu-dialog-container"}}export{B as D};
