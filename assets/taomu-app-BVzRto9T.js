import{t as E,a as l,F as y,h as S,j as A,G as F}from"./mini-scrollbar-DFcjLXiE.js";import{R as o}from"./index-D4lIrffr.js";import{g as c}from"./global-vars-hpilZV8k.js";import{g as d,u as i}from"./use-custom-event-CXg9XaYH.js";import{p as T}from"./popup.store-D-RoL1D3.js";function g(e){const{theme:s,systemTheme:a}=E.useStore(["theme","systemTheme"]),[t,p]=o.useState(a||"dark");return o.useEffect(()=>{var r;let u;s==="system"?u=a||"dark":u=s,p(u),(r=e==null?void 0:e.onThemeChange)==null||r.call(e,u),localStorage.setItem("taomu-theme",t)},[s,a]),{theme:t}}const m=()=>{const{popupsMap:e,updateCount:s}=T.useStore(["popupsMap","updateCount"]),a=o.useMemo(()=>{const t=[];for(const[p,[u,r]]of e)t.push(u.render(r));return t},[e,s]);return l(y,{children:a})};try{m.displayName="PopupService",m.__docgenInfo={description:"",displayName:"PopupService",props:{}}}catch{}let n="";const h=({children:e,serverRender:s,serverConfig:a})=>{const t=o.useRef(S()),{theme:p}=g(s?a:void 0),[u,r]=o.useState(c()),[f,_]=o.useState(d());return i("taomu://update-global-css-vars",()=>{r(c())}),i("taomu://update-global-style",()=>{_(d())}),o.useEffect(()=>{document.documentElement.dataset.theme=p},[p]),o.useEffect(()=>(n?console.error("TaomuApp only support one instance"):n=t.current,()=>{n=""}),[]),A(y,{children:[(!n||n===t.current)&&l(m,{}),l(F,{styles:[u,f]}),e]})};try{h.displayName="TaomuApp",h.__docgenInfo={description:`初始化 TaomuApp

包裹根节点

请确保全局只有一个 TaomuApp`,displayName:"TaomuApp",props:{serverRender:{defaultValue:null,description:"服务端渲染模式",name:"serverRender",required:!1,type:{name:"boolean"}},serverConfig:{defaultValue:null,description:"服务端渲染模式下传入的配置项",name:"serverConfig",required:!1,type:{name:"ServerConfig"}}}}}catch{}export{h as T};
