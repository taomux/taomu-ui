import{t as S,a as l,F as h,g as E,j as A,h as g,G as F}from"./mini-scrollbar-CPC470y1.js";import{R as o}from"./index-D4lIrffr.js";import{g as c}from"./global-vars-CoVtkCb5.js";import{g as d,u as i}from"./use-custom-event-BD6a7dXZ.js";import{p as T}from"./popup.store-D6eLbj-g.js";function b(e){const{theme:s,systemTheme:a}=S.useStore(["theme","systemTheme"]),[t,p]=o.useState(a||"dark");return o.useEffect(()=>{var r;let u;s==="system"?u=a||"dark":u=s,p(u),(r=e==null?void 0:e.onThemeChange)==null||r.call(e,u),localStorage.setItem("taomu-theme",t)},[s,a]),{theme:t}}const m=()=>{const{popupsMap:e,updateCount:s}=T.useStore(["popupsMap","updateCount"]),a=o.useMemo(()=>{const t=[];for(const[p,[u,r]]of e)t.push(u.render(r));return t},[e,s]);return l(h,{children:a})};try{m.displayName="PopupService",m.__docgenInfo={description:"",displayName:"PopupService",props:{}}}catch{}let n="";const y=({children:e,serverRender:s,serverConfig:a})=>{const t=o.useRef(E()),{theme:p}=b(s?a:void 0),[u,r]=o.useState(c()),[f,_]=o.useState(d());return i("taomu://update-global-css-vars",()=>{r(c())}),i("taomu://update-global-style",()=>{_(d())}),o.useEffect(()=>{document.documentElement.dataset.theme=p},[p]),o.useEffect(()=>(n?console.error("TaomuApp only support one instance"):n=t.current,()=>{n=""}),[]),A(h,{children:[(!n||n===t.current)&&l(m,{}),l(F,{styles:[g,u,f]}),e]})};try{y.displayName="TaomuApp",y.__docgenInfo={description:`初始化 TaomuApp

包裹根节点

请确保全局只有一个 TaomuApp`,displayName:"TaomuApp",props:{serverRender:{defaultValue:null,description:"服务端渲染模式",name:"serverRender",required:!1,type:{name:"boolean"}},serverConfig:{defaultValue:null,description:"服务端渲染模式下传入的配置项",name:"serverConfig",required:!1,type:{name:"ServerConfig"}}}}}catch{}export{y as T};
