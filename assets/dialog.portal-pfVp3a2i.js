var R=Object.defineProperty;var m=a=>{throw TypeError(a)};var S=(a,n,t)=>n in a?R(a,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[n]=t;var e=(a,n,t)=>S(a,typeof n!="symbol"?n+"":n,t),P=(a,n,t)=>n.has(a)||m("Cannot "+t);var d=(a,n,t)=>(P(a,n,"read from private field"),t?t.call(a):n.get(a)),y=(a,n,t)=>n.has(a)?m("Cannot add the same private member more than once"):n instanceof WeakSet?n.add(a):n.set(a,t);import{a as g}from"./mini-scrollbar-DFcjLXiE.js";import{R as B}from"./index-D4lIrffr.js";import"./index-Csd1iqiJ.js";import{p as D}from"./popup.store-D-RoL1D3.js";import{D as I}from"./dialog-yu9CWGIt.js";import{P as x}from"./popup-trigger-TjDwbJib.js";var p;class U extends x{constructor(t,s={},o={}){const{onBeforeLeave:i,...c}=o;o=Object.assign(j(),c,{onBeforeLeave:r=>{var l,u;(u=(l=this.dialogOptions)==null?void 0:l.onClose)==null||u.call(l),i==null||i(r)}});super(r=>{const l=d(this,p);return g(l,{...r})},o);e(this,"Content",()=>null);e(this,"asyncCallbackRef",B.createRef());y(this,p,t=>{const s=this.DialogContent;return g(I,{...this.dialogOptions,onClose:this.close,dialogPortalInstance:this,children:g(s,{...t,dialogPortalInstance:this,defineOnOk:this.defineOnOk,defineOnCancel:this.defineOnCancel})})});e(this,"defineOnOk",t=>{this.asyncCallbackRef.current||(this.asyncCallbackRef.current={}),this.asyncCallbackRef.current.onOk=t});e(this,"defineOnCancel",t=>{this.asyncCallbackRef.current||(this.asyncCallbackRef.current={}),this.asyncCallbackRef.current.onCancel=t});e(this,"open",(t,s={},o={})=>new Promise((i,c)=>{let r=0;const{asyncCallback:l,...u}=s,k=l||this.dialogOptions.asyncCallback,b=(O,f)=>{k?k(O,f):(r++,r>1&&console.warn("Dialog Callback 只会触发一次, 请使用 asyncCallback 来替代")),O==="ok"?i(f):c(f)},C=o.onBackgroundClickClose,h=o.onEscClose;o.onBackgroundClickClose=()=>{C==null||C(),c()},o.onEscClose=()=>{h==null||h(),c()},this.updateDialogOptionsStatic({asyncCallback:b,...u}),o&&this.updateBaseOptionsStatic(o),this.baseOpen(t)}));e(this,"dispatchUpdate",(t,s={},o={})=>{const{popupsMap:i,updateCount:c}=D.getState();i.has(this.popupId)&&(s&&this.updateDialogOptionsStatic(s),o&&this.updateBaseOptionsStatic(o),i.set(this.popupId,[this,t]),D.setState({popupsMap:i,updateCount:c+1}))});e(this,"updateDialogOptionsStatic",t=>{Object.assign(this.dialogOptions,t)});e(this,"updateBaseOptionsStatic",t=>{Object.assign(this.baseOptions,t)});this.DialogContent=t,this.dialogOptions=s,this.baseOptions=o,this.Content=d(this,p)}}p=new WeakMap;function j(){return{positionType:"dialog-center",contentAnimationConfig:"dialogZoomOut",overlay:!0,clickToClose:!1,lockScroll:!0,createContainerId:"taomu-dialog-container"}}export{U as D};
